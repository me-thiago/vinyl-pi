<story-context id="v1-22-documentacao-basica" v="1.0">
  <metadata>
    <epicId>V1</epicId>
    <storyId>22</storyId>
    <title>Documentação Básica</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-30</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/v1/v1-22-documentacao-basica.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>usuário</asA>
    <iWant>ter documentação suficiente para usar o sistema</iWant>
    <soThat>possa configurar e operar sem ajuda externa</soThat>
    <tasks>
      <task id="1">Revisar e completar README.md</task>
      <task id="2">Adicionar seção de visão geral do projeto</task>
      <task id="3">Documentar requisitos de hardware</task>
      <task id="4">Completar instruções de instalação</task>
      <task id="5">Documentar como usar (player, dashboard, diagnóstico)</task>
      <task id="6">Adicionar seção de troubleshooting</task>
      <task id="7">Verificar e adicionar JSDoc/TSDoc no código</task>
      <task id="8">Adicionar comentários em configurações importantes</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1" priority="must">
      <description>README.md atualizado com visão geral do projeto</description>
      <currentState>PARCIAL - Existe mas pode ser melhorado</currentState>
      <analysis>
        O README.md atual já tem:
        ✅ Visão geral básica
        ✅ Stack tecnológico
        ✅ Requisitos de sistema
        ✅ Instruções de instalação
        ✅ Instruções de execução
        ✅ Seção PM2
        ✅ Estrutura do projeto
        ✅ Links para docs

        FALTA:
        - Seção "Features" destacando funcionalidades
        - Screenshots/GIFs da interface
        - Badges (build status, version, etc.)
        - Seção "Como Usar" mais detalhada
        - Troubleshooting expandido
      </analysis>
      <referenceFiles>
        <file path="README.md" />
      </referenceFiles>
    </criterion>

    <criterion id="AC2" priority="must">
      <description>README.md com requisitos de hardware</description>
      <currentState>NÃO PRESENTE NO README</currentState>
      <analysis>
        O PRD v3.0 (Seção 4) tem requisitos de hardware detalhados:
        - Raspberry Pi 4B (4GB) ou Pi 5
        - MicroSD 32GB Class 10
        - Interface USB (Behringer UCA222/202HD)
        - Toca-discos com saída LINE
        - Fonte oficial Raspberry Pi
        - Rede Ethernet recomendada

        O README.md atual só menciona requisitos de software.
        Precisa adicionar seção de hardware.
      </analysis>
      <referenceFiles>
        <file path="docs/prd-v3.md" section="4. Requisitos de Hardware" />
      </referenceFiles>
    </criterion>

    <criterion id="AC3" priority="must">
      <description>README.md com instruções de instalação completas</description>
      <currentState>PARCIAL - Instruções manuais existem</currentState>
      <analysis>
        README.md já tem instruções de instalação manual detalhadas.

        Após V1.21 (Install Script), precisa:
        1. Adicionar instrução do script automatizado como método principal
        2. Manter instruções manuais como alternativa/referência
        3. Adicionar seção "Verificação Pós-Instalação"
      </analysis>
      <referenceFiles>
        <file path="README.md" section="Instalação" />
        <file path="docs/stories/v1-21-install-script.context.xml" />
      </referenceFiles>
    </criterion>

    <criterion id="AC4" priority="must">
      <description>README.md com como usar (player, dashboard, diagnóstico)</description>
      <currentState>NÃO PRESENTE</currentState>
      <analysis>
        Falta documentar para o usuário final:

        1. **Player**: Como ouvir o streaming
           - URLs de acesso (http://IP:8000/stream)
           - Players compatíveis (VLC, browser, etc.)
           - Qualidade de áudio (320kbps MP3)

        2. **Dashboard**: Interface web
           - URL de acesso (http://IP:3000)
           - O que cada seção mostra
           - VU meter em tempo real
           - Indicadores de status

        3. **Diagnóstico**: Página de diagnóstico
           - Como acessar
           - Como interpretar métricas
           - Como ajustar thresholds (silêncio, clipping)

        4. **Configurações**: Página de settings
           - Parâmetros configuráveis
           - Como salvar alterações
      </analysis>
    </criterion>

    <criterion id="AC5" priority="must">
      <description>README.md com troubleshooting comum</description>
      <currentState>NÃO PRESENTE NO README</currentState>
      <analysis>
        O PRD v3.0 (Seção 10.3) tem tabela de troubleshooting:
        - "Device not found" → Verificar arecord -l
        - "Permission denied" → usermod -a -G audio
        - "No sound" → amixer, alsamixer
        - "Connection refused" → systemctl status icecast2
        - "Buffer underrun" → Aumentar buffer_size

        Também existe docs/troubleshooting/ com casos específicos.
        Precisa consolidar no README.
      </analysis>
      <referenceFiles>
        <file path="docs/prd-v3.md" section="10.3 Troubleshooting Comum" />
        <file path="docs/troubleshooting/2025-11-03-streaming-regression.md" />
      </referenceFiles>
    </criterion>

    <criterion id="AC6" priority="should">
      <description>Documentação inline no código (JSDoc/TSDoc)</description>
      <currentState>PARCIAL - Alguns arquivos têm, maioria não</currentState>
      <analysis>
        Análise atual (31 ocorrências de JSDoc/TSDoc em 7 arquivos):
        - audio-manager.ts: 10 ocorrências ✓
        - event-bus.ts: 9 ocorrências ✓
        - audio-analyzer.ts: 1 ocorrência
        - health-monitor.ts: 1 ocorrência
        - lifecycle.ts: 3 ocorrências ✓
        - logger.ts: 2 ocorrências

        Arquivos SEM documentação adequada:
        - Rotas (status.ts, events.ts, sessions.ts, settings.ts)
        - Services (event-detector.ts, session-manager.ts, socket-manager.ts)
        - Middleware (error-handler.ts)
        - Tipos e interfaces

        PRIORIZAR:
        1. Interfaces públicas (rotas, tipos exportados)
        2. Funções complexas em services
        3. Configurações e constantes
      </analysis>
      <filesToModify>
        <file path="backend/src/routes/*.ts" reason="Documentar endpoints da API" />
        <file path="backend/src/services/*.ts" reason="Documentar classes principais" />
        <file path="backend/src/middleware/*.ts" reason="Documentar middlewares" />
      </filesToModify>
    </criterion>

    <criterion id="AC7" priority="should">
      <description>Comentários em configurações importantes</description>
      <currentState>PARCIAL</currentState>
      <analysis>
        Arquivos de configuração e seu estado:

        ✅ config/icecast.xml - Bem comentado
        ✅ ecosystem.config.js - Estrutura clara
        ⚠️ backend/.env - Não existe template documentado
        ⚠️ backend/prisma/schema.prisma - Poucos comentários
        ⚠️ frontend/vite.config.ts - Sem comentários
        ⚠️ tsconfig.json files - Sem comentários

        PRIORIZAR:
        1. Criar .env.example com comentários explicativos
        2. Adicionar comentários no schema.prisma
      </analysis>
      <filesToCreate>
        <file path="backend/.env.example" reason="Template de variáveis de ambiente documentado" />
      </filesToCreate>
      <filesToModify>
        <file path="backend/prisma/schema.prisma" reason="Adicionar comentários nos modelos" />
      </filesToModify>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="README.md" title="README Principal" section="Todo o arquivo">
        Documentação principal atual. Precisa ser expandido com hardware, uso, troubleshooting.
      </doc>
      <doc path="docs/prd-v3.md" title="PRD v3.0" section="Múltiplas seções">
        Fonte primária para requisitos de hardware, troubleshooting, casos de uso.
      </doc>
      <doc path="docs/architecture.md" title="Arquitetura" section="Todo o arquivo">
        Documentação técnica detalhada. Referência para documentação de código.
      </doc>
      <doc path="scripts/README.md" title="Scripts README" section="Todo o arquivo">
        Exemplo de boa documentação de scripts auxiliares.
      </doc>
    </docs>

    <code>
      <file path="backend/src/services/audio-manager.ts" kind="service" reason="Exemplo de JSDoc bem feito">
        Tem documentação JSDoc abrangente. Usar como modelo para outros arquivos.
      </file>
      <file path="backend/src/utils/event-bus.ts" kind="utility" reason="Exemplo de JSDoc bem feito">
        Documentação completa de EventBus. Modelo para utilitários.
      </file>
      <file path="config/icecast.xml" kind="config" reason="Exemplo de config bem comentada">
        Arquivo XML com comentários explicativos. Modelo para outras configs.
      </file>
    </code>

    <currentDocumentation>
      <item path="README.md" status="exists" quality="good">
        ~300 linhas. Cobre instalação, execução, PM2, estrutura.
      </item>
      <item path="docs/prd-v3.md" status="exists" quality="excellent">
        Documento completo de requisitos. Fonte de verdade.
      </item>
      <item path="docs/architecture.md" status="exists" quality="excellent">
        Arquitetura detalhada com decisões técnicas.
      </item>
      <item path="docs/epics.md" status="exists" quality="good">
        Visão de epics e stories.
      </item>
      <item path="scripts/README.md" status="exists" quality="excellent">
        Documentação do system-health.sh.
      </item>
    </currentDocumentation>
  </artifacts>

  <interfaces>
    <interface name="Frontend Pages" kind="ui" path="frontend/src/pages/">
      <pages>
        <page name="Dashboard" url="/" description="Visão geral com player e status" />
        <page name="Diagnostics" url="/diagnostics" description="VU meter e ajuste de thresholds" />
        <page name="Sessions" url="/sessions" description="Histórico de sessões" />
        <page name="Settings" url="/settings" description="Configurações do sistema" />
      </pages>
    </interface>
    <interface name="Streaming URLs" kind="http">
      <endpoints>
        <endpoint url="http://IP:8000/stream" description="Stream MP3 320kbps" />
        <endpoint url="http://IP:8000/status.xsl" description="Status Icecast" />
        <endpoint url="http://IP:3001/health" description="Health check backend" />
        <endpoint url="http://IP:3001/api/status" description="Status completo API" />
      </endpoints>
    </interface>
  </interfaces>

  <constraints>
    <constraint type="language">
      Documentação deve ser em Português BR para o usuário final.
      JSDoc/TSDoc em inglês (padrão técnico).
    </constraint>
    <constraint type="audience">
      README e docs de usuário: público não-técnico ("Vinyl Enthusiast").
      Deve ser simples e direto, sem jargão excessivo.
    </constraint>
    <constraint type="maintenance">
      Documentação deve ser mantida junto com código.
      Evitar duplicação que pode ficar desatualizada.
    </constraint>
  </constraints>

  <tests>
    <standards>
      Não há testes automatizados para documentação.
      Validar manualmente seguindo instruções em ambiente limpo.
    </standards>
    <ideas>
      <idea forAC="AC1">Revisar README.md com olhar de usuário novo</idea>
      <idea forAC="AC2">Validar requisitos de hardware contra PRD</idea>
      <idea forAC="AC3">Seguir instruções de instalação em VM limpa</idea>
      <idea forAC="AC4">Pedir para pessoa não-técnica usar o sistema apenas com README</idea>
      <idea forAC="AC5">Simular problemas comuns e verificar se troubleshooting ajuda</idea>
      <idea forAC="AC6">Gerar documentação com typedoc e verificar cobertura</idea>
      <idea forAC="AC7">Revisar cada arquivo de config para clareza</idea>
    </ideas>
  </tests>

  <currentStateAnalysis>
    <summary>
      O projeto tem documentação técnica excelente (PRD, Architecture) mas falta
      documentação focada no usuário final. O README.md existe mas precisa de
      seções adicionais (hardware, uso, troubleshooting). JSDoc/TSDoc está
      presente em alguns arquivos críticos mas falta na maioria.
    </summary>

    <existingImplementation>
      <item status="exists">README.md com instalação e execução</item>
      <item status="exists">docs/prd-v3.md completo</item>
      <item status="exists">docs/architecture.md detalhado</item>
      <item status="exists">scripts/README.md excelente</item>
      <item status="partial">JSDoc em 7 arquivos (31 ocorrências)</item>
      <item status="exists">config/icecast.xml bem comentado</item>
    </existingImplementation>

    <requiredChanges>
      <change priority="high">Adicionar seção de Hardware ao README</change>
      <change priority="high">Adicionar seção "Como Usar" ao README</change>
      <change priority="high">Adicionar seção Troubleshooting ao README</change>
      <change priority="medium">Criar .env.example documentado</change>
      <change priority="medium">Adicionar JSDoc nos routes</change>
      <change priority="medium">Adicionar JSDoc nos services restantes</change>
      <change priority="low">Adicionar comentários em prisma schema</change>
    </requiredChanges>

    <estimatedEffort>
      Baixa-média complexidade. Principalmente escrita de documentação.
      JSDoc requer revisar ~15 arquivos TypeScript.
    </estimatedEffort>
  </currentStateAnalysis>
</story-context>
