# Story V1.5-08: Aumentar Cobertura de Testes do Frontend

**Epic:** V1.5 - Hardening & Quality (Post-Audit)

**Status:** ready-for-dev

**Prioridade:** üü¢ M√©dio

**Origem:** Relat√≥rio de Auditoria 2025-12-03 - Se√ß√£o 9: Testes & CI (7/10)

**User Story:**
Como desenvolvedor,
quero ter maior cobertura de testes no frontend,
para que regress√µes sejam detectadas automaticamente.

## Contexto do Problema

A cobertura de testes do frontend √© baixa:

```
# Auditoria identificou:
- Cobertura frontend baixa (apenas 3 arquivos testados)
- Frontend Components: 2 arquivos ‚ö†Ô∏è
- Frontend Hooks: 1 arquivo ‚ö†Ô∏è
```

Com apenas 3 arquivos de teste, muitos componentes e hooks n√£o est√£o cobertos.

## Crit√©rios de Aceita√ß√£o

1. [ ] Cobertura de testes > 60% para componentes principais
2. [ ] Todos os hooks customizados testados (`useSocket`, `useAudioStream`, etc.)
3. [ ] Componentes cr√≠ticos testados (Player, Dashboard, Settings)
4. [ ] Testes de integra√ß√£o para fluxos principais
5. [ ] Relat√≥rio de cobertura configurado no Vitest

## Pr√©-requisitos

- Vitest j√° configurado no frontend

## Refer√™ncias

- [Relat√≥rio de Auditoria](../../audit-report-2025-12-03.md) - Se√ß√£o 9: Testes & CI
- [Vitest Documentation](https://vitest.dev/)
- [Testing Library](https://testing-library.com/docs/react-testing-library/intro/)

---

## Tasks/Subtasks

- [ ] Task 1: Configurar relat√≥rio de cobertura
  - [ ] Atualizar vite.config.ts com coverage provider
  - [ ] Adicionar script `test:coverage` ao package.json
  - [ ] Configurar thresholds m√≠nimos

- [ ] Task 2: Testar Hooks customizados
  - [ ] Criar `__tests__/hooks/useSocket.test.ts`
  - [ ] Criar `__tests__/hooks/useAudioStream.test.ts`
  - [ ] Criar `__tests__/hooks/useSettings.test.ts` (se existir)

- [ ] Task 3: Testar Componentes principais
  - [ ] Criar `__tests__/components/Player.test.tsx`
  - [ ] Criar `__tests__/components/VUMeter.test.tsx`
  - [ ] Criar `__tests__/components/EventLog.test.tsx`
  - [ ] Criar `__tests__/components/SessionList.test.tsx`

- [ ] Task 4: Testar P√°ginas
  - [ ] Criar `__tests__/pages/Dashboard.test.tsx`
  - [ ] Criar `__tests__/pages/Settings.test.tsx`
  - [ ] Criar `__tests__/pages/Diagnostics.test.tsx`

- [ ] Task 5: Testes de integra√ß√£o
  - [ ] Testar fluxo de play/pause do Player
  - [ ] Testar atualiza√ß√£o em tempo real via WebSocket mock

---

## Implementa√ß√£o Sugerida

### Configura√ß√£o de Cobertura

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: './src/test/setup.ts',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        'src/main.tsx',
        'src/vite-env.d.ts'
      ],
      thresholds: {
        lines: 60,
        functions: 60,
        branches: 50,
        statements: 60
      }
    }
  }
});
```

### Exemplo de Teste de Hook

```typescript
// frontend/src/__tests__/hooks/useSocket.test.ts
import { renderHook, act } from '@testing-library/react';
import { useSocket } from '../../hooks/useSocket';
import { vi } from 'vitest';

// Mock socket.io-client
vi.mock('socket.io-client', () => ({
  io: vi.fn(() => ({
    on: vi.fn(),
    off: vi.fn(),
    emit: vi.fn(),
    connected: true,
    disconnect: vi.fn()
  }))
}));

describe('useSocket', () => {
  it('should connect on mount', () => {
    const { result } = renderHook(() => useSocket());
    expect(result.current.isConnected).toBe(true);
  });

  it('should handle status updates', () => {
    const { result } = renderHook(() => useSocket());
    // Test event handling...
  });
});
```

### Exemplo de Teste de Componente

```typescript
// frontend/src/__tests__/components/Player.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Player } from '../../components/Player';
import { vi } from 'vitest';

describe('Player', () => {
  it('renders play button when stopped', () => {
    render(<Player />);
    expect(screen.getByRole('button', { name: /play/i })).toBeInTheDocument();
  });

  it('toggles to pause when clicked', () => {
    render(<Player />);
    const playButton = screen.getByRole('button', { name: /play/i });
    fireEvent.click(playButton);
    expect(screen.getByRole('button', { name: /pause/i })).toBeInTheDocument();
  });
});
```

---

## Dev Agent Record

### Context Reference
- Story Context: [v1.5-08-testes-frontend.context.xml](./v1.5-08-testes-frontend.context.xml)

### Debug Log
- (a ser preenchido durante implementa√ß√£o)

### Completion Notes
- (a ser preenchido ap√≥s conclus√£o)

---

## File List

### Arquivos a Criar
- frontend/src/__tests__/hooks/useSocket.test.ts
- frontend/src/__tests__/hooks/useAudioStream.test.ts
- frontend/src/__tests__/components/Player.test.tsx
- frontend/src/__tests__/components/VUMeter.test.tsx
- frontend/src/__tests__/components/EventLog.test.tsx
- frontend/src/__tests__/pages/Dashboard.test.tsx
- frontend/src/__tests__/pages/Settings.test.tsx

### Arquivos a Modificar
- frontend/vite.config.ts (coverage config)
- frontend/package.json (scripts)

---

## Change Log

- 2025-12-04: Story criada a partir do relat√≥rio de auditoria

