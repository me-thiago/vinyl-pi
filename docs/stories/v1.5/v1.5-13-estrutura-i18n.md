# Story V1.5-13: Preparar Estrutura para Internacionaliza√ß√£o (i18n)

**Epic:** V1.5 - Hardening & Quality (Post-Audit)

**Status:** drafted

**Prioridade:** üîµ Baixo

**Origem:** Relat√≥rio de Auditoria 2025-12-03 - Se√ß√£o 4: Frontend (7/10)

**User Story:**
Como desenvolvedor,
quero que o frontend tenha estrutura preparada para internacionaliza√ß√£o,
para que futuramente possa suportar m√∫ltiplos idiomas facilmente.

## Contexto do Problema

Atualmente h√° strings hardcoded em portugu√™s na UI:

```
# Auditoria identificou:
- Hardcoded strings na UI (sem i18n preparado)
```

Isso dificulta adicionar suporte a outros idiomas no futuro.

## Crit√©rios de Aceita√ß√£o

1. [ ] react-i18next instalado e configurado
2. [ ] Arquivo de tradu√ß√µes para portugu√™s BR criado
3. [ ] Principais componentes migrados para usar i18n
4. [ ] Detec√ß√£o autom√°tica de idioma do navegador
5. [ ] Fallback para portugu√™s quando tradu√ß√£o n√£o existe
6. [ ] Hook `useTranslation` dispon√≠vel em todos componentes

## Pr√©-requisitos

- Nenhum

## Refer√™ncias

- [Relat√≥rio de Auditoria](../../audit-report-2025-12-03.md) - Se√ß√£o 4: Frontend
- [react-i18next](https://react.i18next.com/)
- [i18next](https://www.i18next.com/)

---

## Tasks/Subtasks

- [ ] Task 1: Instalar e configurar i18next
  - [ ] Instalar i18next e react-i18next
  - [ ] Criar configura√ß√£o em `src/i18n/index.ts`
  - [ ] Inicializar em main.tsx

- [ ] Task 2: Criar arquivos de tradu√ß√£o
  - [ ] Criar `src/i18n/locales/pt-BR.json`
  - [ ] Criar `src/i18n/locales/en.json` (placeholder)
  - [ ] Estruturar namespaces (common, player, settings, etc.)

- [ ] Task 3: Migrar strings hardcoded
  - [ ] Migrar Player component
  - [ ] Migrar Dashboard component
  - [ ] Migrar Settings component
  - [ ] Migrar ErrorBoundary
  - [ ] Migrar Navigation/Menu

- [ ] Task 4: Configurar detec√ß√£o de idioma
  - [ ] Detectar idioma do navegador
  - [ ] Persistir prefer√™ncia em localStorage
  - [ ] Adicionar seletor de idioma em Settings (opcional)

- [ ] Task 5: Validar cobertura
  - [ ] Verificar console para chaves faltantes
  - [ ] Criar script para detectar strings n√£o traduzidas

---

## Implementa√ß√£o Sugerida

### Configura√ß√£o i18next

```typescript
// frontend/src/i18n/index.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import ptBR from './locales/pt-BR.json';
import en from './locales/en.json';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources: {
      'pt-BR': { translation: ptBR },
      en: { translation: en },
    },
    fallbackLng: 'pt-BR',
    interpolation: {
      escapeValue: false, // React j√° escapa
    },
    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
    },
  });

export default i18n;
```

### Arquivo de Tradu√ß√£o pt-BR

```json
// frontend/src/i18n/locales/pt-BR.json
{
  "common": {
    "loading": "Carregando...",
    "error": "Erro",
    "save": "Salvar",
    "cancel": "Cancelar",
    "retry": "Tentar novamente",
    "reload": "Recarregar p√°gina"
  },
  "player": {
    "title": "Player",
    "play": "Reproduzir",
    "pause": "Pausar",
    "volume": "Volume",
    "listeners": "{{count}} ouvinte",
    "listeners_plural": "{{count}} ouvintes",
    "notStreaming": "Stream n√£o iniciado",
    "connecting": "Conectando..."
  },
  "dashboard": {
    "title": "Dashboard",
    "status": "Status do Sistema",
    "streaming": "Transmitindo",
    "stopped": "Parado",
    "currentSession": "Sess√£o Atual",
    "recentEvents": "Eventos Recentes",
    "noSession": "Nenhuma sess√£o ativa"
  },
  "settings": {
    "title": "Configura√ß√µes",
    "audioDevice": "Dispositivo de √Åudio",
    "theme": "Tema",
    "themeLight": "Claro",
    "themeDark": "Escuro",
    "themeSystem": "Sistema",
    "silenceThreshold": "Limiar de Sil√™ncio",
    "silenceDuration": "Dura√ß√£o de Sil√™ncio",
    "sessionTimeout": "Timeout de Sess√£o",
    "saved": "Configura√ß√µes salvas!"
  },
  "sessions": {
    "title": "Hist√≥rico de Sess√µes",
    "session": "Sess√£o",
    "duration": "Dura√ß√£o",
    "events": "Eventos",
    "noSessions": "Nenhuma sess√£o encontrada"
  },
  "errors": {
    "title": "Algo deu errado",
    "description": "Ocorreu um erro inesperado na aplica√ß√£o.",
    "tryAgain": "Tentar novamente",
    "reloadPage": "Recarregar p√°gina"
  },
  "diagnostics": {
    "title": "Diagn√≥stico",
    "audioLevel": "N√≠vel de √Åudio",
    "thresholds": "Limiares",
    "eventLog": "Log de Eventos"
  }
}
```

### Uso nos Componentes

```typescript
// frontend/src/components/Player.tsx
import { useTranslation } from 'react-i18next';

export function Player() {
  const { t } = useTranslation();
  
  return (
    <div>
      <h1>{t('player.title')}</h1>
      <button>
        {isPlaying ? t('player.pause') : t('player.play')}
      </button>
      <span>
        {t('player.listeners', { count: listenerCount })}
      </span>
    </div>
  );
}
```

### Inicializa√ß√£o em main.tsx

```typescript
// frontend/src/main.tsx
import './i18n'; // Importar antes do App

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

---

## Notas

- Esta story prepara a estrutura, mas n√£o adiciona novos idiomas al√©m de pt-BR
- O arquivo en.json pode ser uma c√≥pia de pt-BR inicialmente
- Considerar usar namespaces se o arquivo ficar muito grande

---

## Dev Agent Record

### Context Reference
- Story Context: (a ser criado quando ready-for-dev)

### Debug Log
- (a ser preenchido durante implementa√ß√£o)

### Completion Notes
- (a ser preenchido ap√≥s conclus√£o)

---

## File List

### Arquivos a Criar
- frontend/src/i18n/index.ts
- frontend/src/i18n/locales/pt-BR.json
- frontend/src/i18n/locales/en.json

### Arquivos a Modificar
- frontend/package.json
- frontend/src/main.tsx
- frontend/src/components/*.tsx (m√∫ltiplos)
- frontend/src/pages/*.tsx (m√∫ltiplos)

---

## Change Log

- 2025-12-04: Story criada a partir do relat√≥rio de auditoria

